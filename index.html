<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Questionnaire ‚Äî QCM & QRO</title>
  <style>
    :root{
      --border:#e5e7eb; --muted:#6b7280; --bg:#ffffff; --soft:#f9fafb;
      --ok:#16a34a; --ko:#dc2626; --ink:#111827;
    }
    body{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin:24px; line-height:1.45; color:var(--ink); background:var(--bg);
    }
    header{ max-width:980px; margin:0 auto 14px auto; }
    h1{ font-size:1.45rem; margin:0 0 8px 0; display:flex; align-items:center; gap:10px; }
    .sub{ margin:0 0 14px 0; color:var(--muted); }
    .bar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    button{
      padding:9px 12px; border:1px solid #9ca3af; border-radius:12px;
      background:var(--soft); cursor:pointer;
    }
    button.primary{ background:#111827; color:#fff; border-color:#111827; }
    button:disabled{ opacity:.55; cursor:not-allowed; }
    .meta{ margin-left:auto; color:var(--muted); font-size:.95rem; }

    main{ max-width:980px; margin:14px auto 44px auto; display:flex; flex-direction:column; gap:14px; }
    .card{
      border:1px solid var(--border); border-radius:16px; padding:14px 14px 12px 14px;
      background:#fff;
    }
    .topline{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; }
    .title{ margin:0; font-size:1.05rem; display:flex; align-items:center; gap:8px; }
    .pill{
      display:inline-block; font-size:.82rem; padding:2px 9px; border:1px solid var(--border);
      border-radius:999px; color:var(--muted); white-space:nowrap;
    }
    .prompt{ margin:8px 0 10px 0; }
    .choices{ display:flex; flex-direction:column; gap:8px; margin:10px 0 10px 0; }
    label.choice{ display:flex; gap:10px; align-items:flex-start; }
    input[type="checkbox"], input[type="radio"]{ margin-top:3px; transform:scale(1.1); }
    textarea{
      width:100%; min-height:92px; resize:vertical; padding:10px;
      border-radius:12px; border:1px solid var(--border); font:inherit;
    }
    .controls{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 6px 0; }
    .feedback{
      margin-top:10px; padding:10px 12px; border-radius:14px; border:1px solid var(--border);
      background:#fafafa; white-space:pre-wrap;
    }
    .feedback.ok{ border-color:#86efac; background:#f0fdf4; }
    .feedback.ko{ border-color:#fca5a5; background:#fef2f2; }
    .muted{ color:var(--muted); }
    .sep{ height:1px; background:var(--border); margin:10px 0; }

    /* Ic√¥nes inline */
    .ico{ width:18px; height:18px; display:inline-block; vertical-align:-3px; }
    .ico svg{ width:18px; height:18px; }
  </style>
</head>
<body>
<header>
  <h1>
    <span class="ico" aria-hidden="true">
      <!-- petit pictogramme "quiz" -->
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M7 7h10M7 12h7M7 17h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"
              stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    Questionnaire ‚Äî QCM & QRO
  </h1>

  <div class="bar">
    <button class="primary" id="btnNew">Nouveau tirage</button>
    <span class="meta" id="meta"></span>
  </div>
</header>

<main id="app"></main>

<script>
/** =========================
 *  1) BANQUE DE QUESTIONS (√† remplir ensuite depuis tes PDF)
 *  ========================= */
// =======================
// QUESTION_BANK ‚Äî PARTIE 1
// Module 3 + Physio/Patho (semaines 1-2)
// solutionText = explication (sans lettres, sans "Bonne(s) r√©ponse(s)")
// =======================

const QUESTION_BANK = [
  // -------- Module 3 --------
  {
    id: "m3_1",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Le corps jaune a comme fonction de :",
    choices: [
      { text: "S√©cr√©ter la progest√©rone et des ≈ìstrog√®nes", correct: true },
      { text: "S√©cr√©ter la testost√©rone", correct: false },
      { text: "S√©cr√©ter du mucus vaginal", correct: false },
      { text: "S√©cr√©ter le lait mammaire", correct: false }
    ],
    solutionText:
      "Le corps jaune (issu du follicule apr√®s l‚Äôovulation) s√©cr√®te surtout la progest√©rone et aussi des ≈ìstrog√®nes pour pr√©parer et maintenir l‚Äôendom√®tre."
  },
  {
    id: "m3_2",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "Vrai ou Faux : Le corps jaune demeure actif jusqu'√† ce que le placenta commence sa s√©cr√©tion hormonale.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "En d√©but de grossesse, le corps jaune est maintenu (notamment par l‚ÄôhCG) et assure la s√©cr√©tion de progest√©rone, puis le placenta prend progressivement le relais hormonal."
  },
  {
    id: "m3_3",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "Dans quelle phase du cycle menstruel trouve-t-on une production √©lev√©e de progest√©rone ?",
    choices: [
      { text: "Phase s√©cr√©toire", correct: true },
      { text: "Phase prolif√©rative", correct: false },
      { text: "Phase menstruelle", correct: false }
    ],
    solutionText:
      "La progest√©rone est maximale apr√®s l‚Äôovulation (phase lut√©ale), ce qui correspond √† la phase s√©cr√©toire de l‚Äôendom√®tre."
  },
  {
    id: "m3_4",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "P√©riode de d√©veloppement et de maturation du follicule lors du cycle ovarien :",
    choices: [
      { text: "Phase ovulatoire", correct: false },
      { text: "Phase folliculaire", correct: true },
      { text: "Phase lut√©ale", correct: false },
      { text: "Phase s√©cr√©toire", correct: false }
    ],
    solutionText:
      "La croissance et la maturation des follicules se font pendant la phase folliculaire, avant l‚Äôovulation."
  },
  {
    id: "m3_5",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "Hormone qui agit sur l'ovaire en stimulant la croissance d'un follicule :",
    choices: [
      { text: "Hormone lut√©inisante (LH)", correct: false },
      { text: "≈ístrog√®ne", correct: false },
      { text: "Progest√©rone", correct: false },
      { text: "Hormone folliculo-stimulante (FSH)", correct: true }
    ],
    solutionText:
      "La FSH stimule la croissance et la maturation des follicules ovariens (recrutement et d√©veloppement folliculaire)."
  },
  {
    id: "m3_6",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Laquelle parmi ces hormones est s√©cr√©t√©e par l'hypothalamus ?",
    choices: [
      { text: "Progest√©rone", correct: false },
      { text: "Hormone folliculo-stimulante", correct: false },
      { text: "≈ístrog√®ne", correct: false },
      { text: "Gonadolib√©rine (GnRH)", correct: true }
    ],
    solutionText:
      "L‚Äôhypothalamus s√©cr√®te la GnRH, qui stimule l‚Äôhypophyse √† lib√©rer FSH et LH."
  },
  {
    id: "m3_7",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Hormone qui d√©clenche l‚Äôovulation (phase ovulatoire) :",
    choices: [
      { text: "Hormone lut√©inisante (LH)", correct: true },
      { text: "≈ístrog√®ne", correct: false },
      { text: "Progest√©rone", correct: false },
      { text: "Hormone folliculo-stimulante", correct: false }
    ],
    solutionText:
      "Le pic de LH est l‚Äô√©v√©nement cl√© qui d√©clenche l‚Äôovulation (rupture folliculaire et lib√©ration de l‚Äôovocyte)."
  },
  {
    id: "m3_8",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Laquelle n'est PAS une des couches de l‚Äôut√©rus :",
    choices: [
      { text: "S√©reuse protectrice", correct: false },
      { text: "Myom√®tre", correct: false },
      { text: "Endom√®tre", correct: false },
      { text: "Ectom√®tre", correct: true }
    ],
    solutionText:
      "Les couches classiques de l‚Äôut√©rus sont l‚Äôendom√®tre, le myom√®tre et la s√©reuse (p√©rim√®tre). ¬´ Ectom√®tre ¬ª n‚Äôest pas une couche standard."
  },
  {
    id: "m3_9",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "√âtape du cycle ut√©rin o√π, sous l'influence des ≈ìstrog√®nes et de la progest√©rone du corps jaune, l'endom√®tre continue √† s'√©paissir :",
    choices: [
      { text: "Phase menstruelle", correct: false },
      { text: "Phase prolif√©rative", correct: false },
      { text: "Phase s√©cr√©toire", correct: true },
      { text: "Phase folliculaire", correct: false }
    ],
    solutionText:
      "Apr√®s l‚Äôovulation, la progest√©rone rend l‚Äôendom√®tre s√©cr√©toire : il s‚Äô√©paissit, devient vascularis√© et apte √† la nidation."
  },
  {
    id: "m3_10",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "La f√©condation a lieu :",
    choices: [
      { text: "Dans le col ut√©rin", correct: false },
      { text: "Dans les ovaires", correct: false },
      { text: "Dans l‚Äôut√©rus", correct: false },
      { text: "Dans la trompe de Fallope", correct: true }
    ],
    solutionText:
      "La f√©condation se produit le plus souvent dans l‚Äôampoule de la trompe ut√©rine (trompe de Fallope), avant la migration vers l‚Äôut√©rus."
  },
  {
    id: "m3_11",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "Lors du cycle ovarien, quelle est la principale cons√©quence du pic de LH ?",
    choices: [
      { text: "D√©clenchement de la lib√©ration de plusieurs ovocytes", correct: false },
      { text: "Transformation du corps jaune en follicule dominant", correct: false },
      {
        text: "Lib√©ration de l‚Äôovocyte de deuxi√®me ordre du follicule dominant",
        correct: true
      },
      { text: "Arr√™t imm√©diat de la production de FSH", correct: false }
    ],
    solutionText:
      "Le pic de LH entra√Æne la reprise de la m√©iose de l‚Äôovocyte et la rupture du follicule dominant, ce qui lib√®re l‚Äôovocyte II."
  },
  {
    id: "m3_12",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Chez la femme, la LH stimule la production d‚Äô≈ìstrog√®nes par les ovaires.",
    choices: [
      { text: "Faux", correct: true },
      { text: "Vrai", correct: false }
    ],
    solutionText:
      "La production d‚Äô≈ìstrog√®nes est surtout stimul√©e par la FSH au niveau des cellules de la granulosa ; la LH agit surtout sur les cellules th√©cales et d√©clenche l‚Äôovulation."
  },
  {
    id: "m3_13",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "La production d‚Äôovules chez la femme se fait :",
    choices: [
      { text: "En continu", correct: false },
      { text: "De mani√®re cyclique", correct: true }
    ],
    solutionText:
      "Apr√®s la pubert√©, la maturation ovocytaire et l‚Äôovulation se d√©roulent de fa√ßon cyclique (environ un cycle par mois)."
  },
  {
    id: "m3_14",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "L'≈ìstrog√®ne est s√©cr√©t√© pendant la phase lut√©ale et la progest√©rone pendant la phase folliculaire.",
    choices: [
      { text: "Faux", correct: true },
      { text: "Vrai", correct: false }
    ],
    solutionText:
      "C‚Äôest l‚Äôinverse : les ≈ìstrog√®nes dominent plut√¥t en phase folliculaire, tandis que la progest√©rone est √©lev√©e en phase lut√©ale (apr√®s ovulation)."
  },
  {
    id: "m3_15",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Quelle(s) hormone(s) est/sont s√©cr√©t√©e(s) par le corps jaune ?",
    choices: [
      { text: "≈ístrog√®ne", correct: false },
      { text: "Progest√©rone", correct: false },
      { text: "Progest√©rone et ≈ìstrog√®nes", correct: true },
      { text: "Testost√©rone", correct: false }
    ],
    solutionText:
      "Le corps jaune s√©cr√®te surtout la progest√©rone et aussi des ≈ìstrog√®nes pour soutenir l‚Äôendom√®tre en vue d‚Äôune implantation."
  },
  {
    id: "m3_16",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "L‚Äôovogen√®se d√©bute √† la 15·µâ semaine de gestation et se d√©roule de mani√®re continue.",
    choices: [
      { text: "Faux", correct: true },
      { text: "Vrai", correct: false }
    ],
    solutionText:
      "L‚Äôovogen√®se commence pendant la vie f≈ìtale, puis s‚Äôinterrompt (blocages m√©√Øotiques) et ne se d√©roule pas de fa√ßon continue tout au long de la vie."
  },
  {
    id: "m3_17",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "La couche externe de l‚Äôut√©rus est appel√©e :",
    choices: [
      { text: "Endom√®tre", correct: false },
      { text: "Grande l√®vre", correct: false },
      { text: "S√©reuse protectrice", correct: true }
    ],
    solutionText:
      "La couche la plus externe de l‚Äôut√©rus est la s√©reuse (aussi appel√©e p√©rim√®tre), qui enveloppe l‚Äôorgane."
  },
  {
    id: "m3_18",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "L‚Äôendom√®tre se contracte pour permettre √† l‚Äôut√©rus d‚Äôexpulser le b√©b√©.",
    choices: [
      { text: "Faux", correct: true },
      { text: "Vrai", correct: false }
    ],
    solutionText:
      "Ce sont les contractions du myom√®tre (couche musculaire) qui expulsent le b√©b√©, pas l‚Äôendom√®tre."
  },
  {
    id: "m3_19",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "O√π se produit la f√©condation dans le syst√®me reproducteur f√©minin ?",
    choices: [
      { text: "Dans les ovaires", correct: false },
      { text: "Dans l‚Äôut√©rus", correct: false },
      { text: "Dans les trompes de Fallope", correct: true },
      { text: "Dans le vagin", correct: false }
    ],
    solutionText:
      "La f√©condation a lieu dans la trompe ut√©rine (le plus souvent dans l‚Äôampoule), puis l‚Äôembryon migre vers l‚Äôut√©rus."
  },
  {
    id: "m3_20",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "Le cycle menstruel se divise en trois phases : menstruelle, prolif√©rative et s√©cr√©toire.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "Le cycle ut√©rin est classiquement d√©crit en 3 phases : menstruelle (desquamation), prolif√©rative (sous ≈ìstrog√®nes) et s√©cr√©toire (sous progest√©rone)."
  },
  {
    id: "m3_21",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "La phase lut√©ale est caract√©ris√©e par une augmentation de la progest√©rone et des ≈ìstrog√®nes, surtout en cas de f√©condation.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "En phase lut√©ale, le corps jaune s√©cr√®te progest√©rone (principalement) et ≈ìstrog√®nes ; en cas de f√©condation, ces s√©cr√©tions sont maintenues."
  },
  {
    id: "m3_22",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Le pH du vagin est basique.",
    choices: [
      { text: "Faux", correct: true },
      { text: "Vrai", correct: false }
    ],
    solutionText:
      "Le pH vaginal est g√©n√©ralement acide, ce qui limite la prolif√©ration de nombreux micro-organismes."
  },
  {
    id: "m3_23",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "Le corps jaune demeure actif jusqu‚Äô√† la fin de la grossesse.",
    choices: [
      { text: "Faux", correct: true },
      { text: "Vrai", correct: false }
    ],
    solutionText:
      "Le corps jaune est surtout crucial au d√©but ; ensuite, le placenta devient la principale source de progest√©rone et d‚Äôautres hormones."
  },
  {
    id: "m3_24",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt: "L‚Äôhypothalamus s√©cr√®te les gonadolib√©rines.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "La GnRH est une gonadolib√©rine produite par l‚Äôhypothalamus pour contr√¥ler la s√©cr√©tion hypophysaire de FSH et LH."
  },
  {
    id: "m3_25",
    type: "QCM",
    mode: "single",
    icon: "üß†",
    prompt:
      "√Ä la pubert√©, la production des ovules implique un seul follicule par cycle.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "Plusieurs follicules peuvent d√©buter leur croissance, mais en g√©n√©ral un seul devient dominant et ovule lors d‚Äôun cycle."
  },

  // -------- Physio / Patho (semaines 1-2) --------
  {
    id: "pp_1",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Quel organe est responsable de la maturation des spermatozo√Ødes avant l'√©jaculation ?",
    choices: [
      { text: "La prostate", correct: false },
      { text: "L'√©pididyme", correct: true },
      { text: "Les v√©sicules s√©minales", correct: false },
      { text: "L'ur√®tre", correct: false }
    ],
    solutionText:
      "Les spermatozo√Ødes acqui√®rent leur motilit√© et leur capacit√© f√©condante lors de leur transit et stockage dans l‚Äô√©pididyme."
  },
  {
    id: "pp_2",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Vrai ou Faux : Les s√©cr√©tions de la glande bulbo-ur√©trale ont pour fonction de nettoyer l'ur√®tre avant le passage du sperme.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "La glande bulbo-ur√©trale (Cowper) s√©cr√®te un mucus lubrifiant qui aide √† nettoyer et neutraliser l‚Äôur√®tre avant l‚Äô√©jaculation."
  },
  {
    id: "pp_3",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Vrai ou Faux : L‚Äô√©jaculation est contr√¥l√©e par des hormones comme la prolactine.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "L‚Äô√©jaculation est principalement un r√©flexe neurov√©g√©tatif (syst√®me nerveux), pas un m√©canisme directement contr√¥l√© par la prolactine."
  },
  {
    id: "pp_4",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Vrai ou Faux : Les cellules de Leydig produisent la testost√©rone en r√©ponse √† la stimulation par la FSH.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "Les cellules de Leydig produisent la testost√©rone surtout sous l‚Äôeffet de la LH ; la FSH agit principalement sur les cellules de Sertoli."
  },
  {
    id: "pp_5",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Vrai ou Faux : La testost√©rone est produite par les v√©sicules s√©minales.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "La testost√©rone est produite par les cellules de Leydig du testicule, pas par les v√©sicules s√©minales."
  },
  {
    id: "pp_6",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Vrai ou Faux : Les spermatozo√Ødes restent dans le corps et s'accumulent pour toujours.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "Les spermatozo√Ødes ont une dur√©e de vie limit√©e : ils sont stock√©s un temps puis r√©absorb√©s/d√©grad√©s s‚Äôils ne sont pas √©jacul√©s."
  },
  {
    id: "pp_7",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Vrai ou Faux : Les spermatogonies se multiplient par mitose.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "Les spermatogonies sont des cellules germinales qui se renouvellent par mitose avant d‚Äôentrer en m√©iose."
  },
  {
    id: "pp_8",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Quel est le site d'origine de la production des spermatozo√Ødes ?",
    choices: [
      { text: "√âpididyme", correct: false },
      { text: "Les tubules s√©minif√®res contourn√©s", correct: true },
      { text: "Les tubules s√©minif√®res droits", correct: false },
      { text: "La prostate", correct: false }
    ],
    solutionText:
      "La spermatogen√®se a lieu dans les tubules s√©minif√®res contourn√©s du testicule."
  },
  {
    id: "pp_9",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Quelles sont les gonades chez l‚Äôhomme ?",
    choices: [
      { text: "Les spermatozo√Ødes", correct: false },
      { text: "Les ovules", correct: false },
      { text: "L'hypothalamus", correct: false },
      { text: "Les testicules", correct: true }
    ],
    solutionText:
      "Les gonades sont les organes producteurs de gam√®tes et d‚Äôhormones sexuelles : chez l‚Äôhomme, ce sont les testicules."
  },
  {
    id: "pp_10",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Quel √©l√©ment ne fait pas partie du trajet des spermatozo√Ødes ?",
    choices: [
      { text: "Tubules s√©minif√®res", correct: false },
      { text: "Canal √©jaculateur", correct: false },
      { text: "Uret√®res", correct: true },
      { text: "Canal d√©f√©rent", correct: false }
    ],
    solutionText:
      "Les uret√®res transportent l‚Äôurine des reins vers la vessie ; ils ne participent pas au trajet des spermatozo√Ødes."
  },
  {
    id: "pp_11",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Vrai ou Faux : La m√©iose sert √† produire des cellules sexuelles.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "La m√©iose r√©duit le nombre de chromosomes et permet la formation de gam√®tes haplo√Ødes."
  },
  {
    id: "pp_12",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Quelle est la diff√©rence entre la mitose et la m√©iose ?",
    choices: [
      {
        text: "La mitose produit des cellules filles identiques, tandis que la m√©iose produit des cellules filles g√©n√©tiquement diff√©rentes.",
        correct: true
      },
      {
        text: "La mitose ne se d√©roule que dans les cellules sexuelles, tandis que la m√©iose se d√©roule dans toutes les cellules du corps.",
        correct: false
      },
      {
        text: "La mitose aboutit √† 4 cellules et la m√©iose √† 2 cellules.",
        correct: false
      }
    ],
    solutionText:
      "La mitose conserve le caryotype et produit des cellules identiques, alors que la m√©iose produit des gam√®tes haplo√Ødes et cr√©e de la diversit√© g√©n√©tique."
  },
  {
    id: "pp_13",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Combien de chromosomes sont pr√©sents dans une cellule somatique humaine (diplo√Øde) ?",
    choices: [
      { text: "56", correct: false },
      { text: "46", correct: true },
      { text: "45", correct: false },
      { text: "22", correct: false }
    ],
    solutionText:
      "Les cellules somatiques humaines sont diplo√Ødes : elles contiennent 46 chromosomes (23 paires)."
  },
  {
    id: "pp_14",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Un chromosome peut √™tre constitu√© de :",
    choices: [
      { text: "Deux chromatides", correct: true },
      { text: "Une seule chromatide", correct: false }
    ],
    solutionText:
      "Apr√®s r√©plication de l‚ÄôADN, un chromosome est form√© de deux chromatides s≈ìurs reli√©es par un centrom√®re."
  },
  {
    id: "pp_15",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Chez les humains, l‚ÄôADN se trouve toujours dans :",
    choices: [
      { text: "Le cytoplasme de la cellule", correct: false },
      { text: "La membrane cellulaire", correct: false },
      { text: "Le noyau de la cellule", correct: true },
      { text: "Autre", correct: false }
    ],
    solutionText:
      "Chez les eucaryotes, l‚Äôessentiel de l‚ÄôADN est dans le noyau (on peut aussi en trouver dans les mitochondries, selon le niveau de d√©tail attendu)."
  },
  {
    id: "pp_16",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Vrai ou Faux : La compl√©mentarit√© de l‚ÄôADN est A‚ÄìC et G‚ÄìT.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "Les appariements corrects sont A‚ÄìT et C‚ÄìG (ad√©nine avec thymine, cytosine avec guanine)."
  },
  {
    id: "pp_19",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Quelle phrase d√©crit l‚Äôanaphase de la mitose ?",
    choices: [
      { text: "Les chromosomes s'alignent sur la plaque √©quatoriale.", correct: false },
      { text: "Les chromatides s≈ìurs se s√©parent et migrent vers les p√¥les oppos√©s.", correct: true },
      { text: "Les chromosomes homologues s'apparient et √©changent des segments.", correct: false },
      { text: "Deux nouvelles membranes nucl√©aires se forment autour des chromosomes.", correct: false }
    ],
    solutionText:
      "En anaphase, les chromatides s≈ìurs sont tir√©es vers des p√¥les oppos√©s par le fuseau mitotique."
  },
  {
    id: "pp_20",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Vrai ou Faux : Dans le chromosome, l‚ÄôADN est d√©condens√©.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "Un chromosome (au sens des phases de division) correspond √† de l‚ÄôADN fortement condens√© ; l‚ÄôADN d√©condens√© correspond plut√¥t √† la chromatine."
  },
  {
    id: "pp_22",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Laquelle parmi ces hormones est s√©cr√©t√©e par l'hypothalamus ?",
    choices: [
      { text: "La progest√©rone", correct: false },
      { text: "L'hormone folliculo-stimulante", correct: false },
      { text: "L'estrog√®ne", correct: false },
      { text: "La gonadolib√©rine (GnRH)", correct: true }
    ],
    solutionText:
      "La GnRH est s√©cr√©t√©e par l‚Äôhypothalamus et contr√¥le la lib√©ration hypophysaire de FSH et LH."
  },
  {
    id: "pp_24",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Vrai ou Faux : L'homme peut produire normalement des spermatozo√Ødes si la temp√©rature testiculaire est de 37¬∞C.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "La spermatogen√®se n√©cessite une temp√©rature l√©g√®rement inf√©rieure √† celle du corps (environ 34‚Äì35¬∞C), d‚Äôo√π la position externe des testicules."
  },
  {
    id: "pp_26",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Vrai ou Faux : La FSH stimule le d√©veloppement folliculaire lors de la phase lut√©ale.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "La FSH stimule surtout le d√©veloppement folliculaire en phase folliculaire ; la phase lut√©ale est domin√©e par l‚Äôactivit√© du corps jaune."
  },
  {
    id: "pp_27",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "La production de spermatozo√Ødes (avec le r√¥le des cellules de Sertoli) est contr√¥l√©e par :",
    choices: [
      { text: "La testost√©rone et l'hormone lut√©inisante", correct: false },
      { text: "L'hormone folliculo-stimulante et l'hormone lut√©inisante", correct: false },
      { text: "La testost√©rone et l'hormone folliculo-stimulante", correct: true },
      { text: "L'hormone lut√©inisante et l'inhibine", correct: false }
    ],
    solutionText:
      "La FSH agit sur les cellules de Sertoli et la testost√©rone (produite sous LH) est indispensable √† la spermatogen√®se."
  },
  {
    id: "pp_28",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Dans quelle phase de la mitose les centrioles se d√©placent-ils vers les p√¥les oppos√©s ?",
    choices: [
      { text: "Prophase", correct: true },
      { text: "M√©taphase", correct: false },
      { text: "Anaphase", correct: false },
      { text: "T√©lophase", correct: false }
    ],
    solutionText:
      "En prophase, le fuseau se met en place et les centrosomes (centrioles) migrent vers les p√¥les."
  },
  {
    id: "pp_29",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Compl√©ter : Les spermatozo√Ødes se rendent √† l'√©pididyme o√π ils s√©journent environ ____ et deviennent matures.",
    choices: [
      { text: "20 jours", correct: true },
      { text: "5 heures", correct: false },
      { text: "30 jours", correct: false },
      { text: "2 heures", correct: false }
    ],
    solutionText:
      "La maturation et le stockage √©pididymaires prennent de l‚Äôordre de plusieurs jours √† semaines ; ici l‚Äôoption attendue correspond √† environ 20 jours."
  },
  {
    id: "pp_30",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "S√©cr√®te un mucus qui nettoie l'int√©rieur de l'ur√®tre avant le passage du sperme :",
    choices: [
      { text: "Glande bulbo-ur√©trale", correct: true },
      { text: "Grandes l√®vres", correct: false },
      { text: "Trompe ut√©rine", correct: false },
      { text: "Conduit d√©f√©rent", correct: false }
    ],
    solutionText:
      "La glande bulbo-ur√©trale s√©cr√®te un mucus lubrifiant qui pr√©pare l‚Äôur√®tre au passage du sperme."
  },
  {
    id: "pp_31",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt: "Conduit qui expulse le sperme dans l'ur√®tre.",
    choices: [
      { text: "Trompe ut√©rine", correct: false },
      { text: "Corps jaune", correct: false },
      { text: "Conduit d√©f√©rent", correct: false },
      { text: "Conduit √©jaculateur", correct: true }
    ],
    solutionText:
      "Le conduit √©jaculateur d√©verse le sperme dans l‚Äôur√®tre lors de l‚Äô√©jaculation."
  },
  {
    id: "pp_32",
    type: "QCM",
    mode: "single",
    icon: "üß¨",
    prompt:
      "Vrai ou Faux : La c√©sarienne consiste √† inciser la paroi musculaire du p√©rin√©e pour faciliter le passage du b√©b√©.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "La c√©sarienne est une chirurgie avec incision de l‚Äôabdomen et de l‚Äôut√©rus ; l‚Äôincision du p√©rin√©e correspond plut√¥t √† une √©pisiotomie."
  },
  {
    id: "m4_1",
    type: "QCM",
    mode: "single",
    icon: "ü§∞",
    prompt:
      "Le gain de poids durant la grossesse est d‚Äôenviron 12 √† 13 kg (‚âà 26‚Äì28 lb).",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "Chez une femme de corpulence normale, la prise de poids recommand√©e pendant la grossesse est en moyenne d‚Äôenviron 12 √† 13 kg."
  },
  {
    id: "m4_2",
    type: "QRO",
    icon: "ü§∞",
    prompt:
      "Quelle glande s√©cr√®te un mucus qui nettoie l‚Äôint√©rieur de l‚Äôur√®tre avant le passage du sperme ?",
    modelAnswer:
      "La glande bulbo-ur√©trale (ou glande de Cowper), qui s√©cr√®te un mucus lubrifiant et neutralisant."
  },
  {
    id: "m4_3",
    type: "QRO",
    icon: "ü§∞",
    prompt: "Quel conduit expulse le sperme dans l‚Äôur√®tre ?",
    modelAnswer:
      "Le conduit √©jaculateur, qui permet l‚Äôarriv√©e du sperme dans l‚Äôur√®tre lors de l‚Äô√©jaculation."
  },
  {
    id: "m4_4",
    type: "QCM",
    mode: "single",
    icon: "ü§∞",
    prompt:
      "La c√©sarienne consiste √† inciser la paroi musculaire du p√©rin√©e pour faciliter le passage du b√©b√©.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "La c√©sarienne est une intervention chirurgicale consistant √† inciser l‚Äôabdomen et l‚Äôut√©rus ; l‚Äôincision du p√©rin√©e correspond √† l‚Äô√©pisiotomie."
  },
  {
    id: "m4_5",
    type: "QRO",
    icon: "ü§∞",
    prompt:
      "Quelle est la principale cause des naus√©es matinales pendant la grossesse, surtout au premier trimestre ?",
    modelAnswer:
      "Les modifications hormonales, en particulier l‚Äôaugmentation de l‚Äôhormone hCG, sont principalement responsables des naus√©es."
  },
  {
    id: "m4_6",
    type: "QRO",
    icon: "ü§∞",
    prompt:
      "√Ä quelle p√©riode du d√©veloppement f≈ìtal le syst√®me immunitaire commence-t-il √† se former et le f≈ìtus r√©agit-il aux stimuli ext√©rieurs ?",
    modelAnswer:
      "Vers la fin du deuxi√®me trimestre, environ entre les semaines 17 et 20 de grossesse."
  },
  {
    id: "m4_7",
    type: "QCM",
    mode: "single",
    icon: "ü§∞",
    prompt:
      "Pendant la phase de d√©livrance de l‚Äôaccouchement, les contractions ut√©rines se poursuivent afin de permettre l‚Äôexpulsion du placenta.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "Apr√®s la naissance du b√©b√©, les contractions persistent pour d√©tacher et expulser le placenta : c‚Äôest la d√©livrance."
  },
  {
    id: "m4_8",
    type: "QRO",
    icon: "ü§∞",
    prompt:
      "Quelle hormone s√©cr√©t√©e pendant la grossesse permet l‚Äôassouplissement de la symphyse pubienne ?",
    modelAnswer:
      "La relaxine, hormone qui favorise le rel√¢chement des ligaments du bassin."
  },
  {
    id: "m4_9",
    type: "QRO",
    icon: "ü§∞",
    prompt: "O√π a lieu la f√©condation chez l‚Äô√™tre humain ?",
    modelAnswer:
      "Dans la trompe de Fallope, le plus souvent au niveau de l‚Äôampoule tubaire."
  },
  {
    id: "m4_10",
    type: "QCM",
    mode: "single",
    icon: "ü§∞",
    prompt: "L‚Äôamnios est la membrane externe du sac amniotique.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "L‚Äôamnios est la membrane interne du sac amniotique ; le chorion constitue la membrane externe."
  },
  {
    id: "m4_11",
    type: "QCM",
    mode: "single",
    icon: "ü§∞",
    prompt:
      "La dur√©e de la grossesse est calcul√©e √† partir du dernier jour de la derni√®re menstruation.",
    choices: [
      { text: "Vrai", correct: true },
      { text: "Faux", correct: false }
    ],
    solutionText:
      "En obst√©trique, l‚Äô√¢ge gestationnel est classiquement calcul√© √† partir du premier jour des derni√®res r√®gles."
  },
  {
    id: "m4_12",
    type: "QCM",
    mode: "single",
    icon: "ü§∞",
    prompt:
      "Le zygote est une cellule haplo√Øde r√©sultant de la fusion de deux gam√®tes diplo√Ødes.",
    choices: [
      { text: "Vrai", correct: false },
      { text: "Faux", correct: true }
    ],
    solutionText:
      "Le zygote est une cellule diplo√Øde issue de la fusion de deux gam√®tes haplo√Ødes (ovule et spermatozo√Øde)."
  }
];



/** =========================
 *  2) UTILS
 *  ========================= */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function deepClone(obj){ return JSON.parse(JSON.stringify(obj)); }
function escapeHtml(s){
  if(s==null) return "";
  return String(s)
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function sameSet(a,b){
  const A=[...a].sort((x,y)=>x-y), B=[...b].sort((x,y)=>x-y);
  if(A.length!==B.length) return false;
  return A.every((v,i)=>v===B[i]);
}

/** =========================
 *  3) √âTAT + G√âN√âRATION
 *  ========================= */
let state = { questions: [] };

function buildAttempt(){
  const q = deepClone(QUESTION_BANK);

  // Random questions
  shuffle(q);

  // Random choices in each QCM
  for(const item of q){
    if(item.type==="QCM" && Array.isArray(item.choices)) shuffle(item.choices);
  }

  state.questions = q;
  render();
}

function metaText(){
  const total=state.questions.length;
  const nQCM=state.questions.filter(x=>x.type==="QCM").length;
  const nQRO=state.questions.filter(x=>x.type==="QRO").length;
  return `${total} exercices ¬∑ ${nQCM} QCM ¬∑ ${nQRO} QRO`;
}

/** =========================
 *  4) RENDU
 *  ========================= */
function render(){
  document.getElementById("meta").textContent = metaText();

  const app=document.getElementById("app");
  app.innerHTML="";

  state.questions.forEach((q, idx) => {
    const exoNum = idx+1;

    const card=document.createElement("section");
    card.className="card";
    card.dataset.qid=q.id;

    // Header
    const modeLabel = q.type==="QCM"
      ? (q.mode==="single" ? "QCM ¬∑ 1 r√©ponse" : "QCM ¬∑ multi r√©ponses")
      : "QRO";
    const icon = q.icon || (q.type==="QCM" ? "üß©" : "‚úçÔ∏è");

    card.innerHTML = `
      <div class="topline">
        <h3 class="title">${escapeHtml(icon)} Exercice ${exoNum}</h3>
        <span class="pill">${modeLabel}</span>
      </div>
      <div class="prompt">${escapeHtml(q.prompt)}</div>
    `;

    // Body
    if(q.type==="QCM"){
      const list=document.createElement("div");
      list.className="choices";

      const groupName = `grp_${q.id}`;
      q.choices.forEach((c, cidx) => {
        const letter = String.fromCharCode(65 + cidx);
        const inputId = `${q.id}_${cidx}`;

        const row=document.createElement("label");
        row.className="choice";

        const input=document.createElement("input");
        input.type = (q.mode==="single") ? "radio" : "checkbox";
        input.name = groupName;
        input.id = inputId;
        input.dataset.correct = String(!!c.correct);

        const span=document.createElement("span");
        span.innerHTML = `<b>${letter}.</b> ${escapeHtml(c.text)}`;

        row.appendChild(input);
        row.appendChild(span);
        list.appendChild(row);
      });

      card.appendChild(list);

      // Controls: submit per QCM
      const controls=document.createElement("div");
      controls.className="controls";

      const btn=document.createElement("button");
      btn.className="primary";
      btn.textContent="Soumettre";
      btn.addEventListener("click", () => submitOneQCM(q.id));

      const btnReset=document.createElement("button");
      btnReset.textContent="R√©initialiser";
      btnReset.addEventListener("click", () => resetOne(q.id));

      controls.appendChild(btn);
      controls.appendChild(btnReset);
      card.appendChild(controls);
    }

    if(q.type==="QRO"){
      const ta=document.createElement("textarea");
      ta.placeholder="√âcris ta r√©ponse ici‚Ä¶";
      ta.id = `ta_${q.id}`;
      card.appendChild(ta);

      const controls=document.createElement("div");
      controls.className="controls";

      const btn=document.createElement("button");
      btn.className="primary";
      btn.textContent="Soumettre";
      btn.addEventListener("click", () => submitOneQRO(q.id));

      const btnReset=document.createElement("button");
      btnReset.textContent="R√©initialiser";
      btnReset.addEventListener("click", () => resetOne(q.id));

      controls.appendChild(btn);
      controls.appendChild(btnReset);
      card.appendChild(controls);
    }

    // Feedback placeholder
    const fb=document.createElement("div");
    fb.className="feedback";
    fb.style.display="none";
    fb.id = `fb_${q.id}`;
    card.appendChild(fb);

    app.appendChild(card);
  });
}

/** =========================
 *  5) ACTIONS : QCM / QRO
 *  ========================= */
function submitOneQCM(qid){
  const q = state.questions.find(x => x.id===qid);
  if(!q) return;

  const card = document.querySelector(`[data-qid="${qid}"]`);
  const inputs = Array.from(card.querySelectorAll("input"));

  // Gather chosen and correct
  const chosen = inputs.map((el, idx)=>({idx, checked:el.checked}))
                       .filter(x=>x.checked).map(x=>x.idx);
  const correctIdx = inputs.map((el, idx)=>({idx, correct:el.dataset.correct==="true"}))
                           .filter(x=>x.correct).map(x=>x.idx);

  const ok = sameSet(chosen, correctIdx);

  // Disable
  inputs.forEach(el => el.disabled = true);
  card.querySelectorAll("button").forEach(b => { if(b.textContent==="Soumettre") b.disabled = true; });

  // Feedback
  const fb = document.getElementById(`fb_${qid}`);
  fb.style.display="block";
  fb.classList.remove("ok","ko");
  fb.classList.add(ok ? "ok" : "ko");

  const correctLetters = correctIdx.map(i => String.fromCharCode(65+i)).join(", ") || "‚Äî";
  fb.textContent =
    (ok ? "‚úÖ Bonne r√©ponse." : "‚ùå Mauvaise r√©ponse.") + "\n\n" +
    `Bonne(s) r√©ponse(s) : ${correctLetters}\n` +
    (q.solutionText ? q.solutionText : "");
}

function submitOneQRO(qid){
  const q = state.questions.find(x => x.id===qid);
  if(!q) return;

  const card = document.querySelector(`[data-qid="${qid}"]`);
  const ta = card.querySelector("textarea");
  const user = (ta.value || "").trim();

  ta.disabled = true;
  card.querySelectorAll("button").forEach(b => { if(b.textContent==="Soumettre") b.disabled = true; });

  const fb = document.getElementById(`fb_${qid}`);
  fb.style.display="block";
  fb.classList.remove("ok","ko");

  fb.textContent =
    "‚úÖ R√©ponse enregistr√©e.\n\n" +
    `Ta r√©ponse : ${user ? user : "(vide)"}\n\n` +
    `R√©ponse propos√©e : ${q.modelAnswer ? q.modelAnswer : "‚Äî"}`;
}

function resetOne(qid){
  const card = document.querySelector(`[data-qid="${qid}"]`);
  if(!card) return;

  // reset inputs/textarea
  card.querySelectorAll("input").forEach(el => { el.checked=false; el.disabled=false; });
  card.querySelectorAll("textarea").forEach(el => { el.value=""; el.disabled=false; });

  // reset feedback
  const fb = document.getElementById(`fb_${qid}`);
  if(fb){
    fb.style.display="none";
    fb.textContent="";
    fb.classList.remove("ok","ko");
  }

  // re-enable submit button
  card.querySelectorAll("button").forEach(b => b.disabled=false);
}

/** =========================
 *  6) GLOBAL BUTTON
 *  ========================= */
document.getElementById("btnNew").addEventListener("click", () => buildAttempt());

/** =========================
 *  7) INIT (randomize on load)
 *  ========================= */
buildAttempt();
</script>
</body>
</html>
